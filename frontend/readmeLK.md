Техническое задание: Модуль личных кабинетов

Цель: Реализовать систему разделения пользователей по ролям с индивидуальным функционалом для каждой группы.

1. Сущности и роли

1.1. Типы пользователей

Роль	Описание	Доступные действия
Соискатель	Создает резюме, ищет вакансии	Просмотр вакансий, отклики, настройки профиля
Работодатель	Публикует вакансии, ищет сотрудников	Создание/редактирование вакансий, просмотр откликов
Модератор	Проверяет контент	Одобрение/удаление вакансий, жалобы
Админ	Управление системой	Бан пользователей, аналитика, настройки
2. Структура БД

2.1. Таблица users

sql
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash TEXT NOT NULL,
  role VARCHAR(20) NOT NULL CHECK (role IN ('job_seeker', 'employer', 'moderator', 'admin')),
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP DEFAULT NOW(),
  last_login TIMESTAMP
);
2.2. Профили (доп. таблицы)

sql
-- Для соискателей
CREATE TABLE job_seekers (
  user_id INTEGER PRIMARY KEY REFERENCES users(id),
  full_name VARCHAR(100),
  phone VARCHAR(20),
  avatar_url TEXT
);

-- Для работодателей
CREATE TABLE employers (
  user_id INTEGER PRIMARY KEY REFERENCES users(id),
  company_name VARCHAR(100),
  company_logo TEXT,
  contact_phone VARCHAR(20)
);
3. API Endpoints

3.1. Регистрация и аутентификация

Метод	Путь	Описание
POST	/auth/register	Регистрация с выбором роли
POST	/auth/login	Вход (JWT-токен)
Пример тела запроса для регистрации:

json
{
  "email": "user@example.com",
  "password": "secure123",
  "role": "job_seeker"
}
3.2. Личные кабинеты

Для соискателей:

GET /job-seeker/profile – Получить профиль
PUT /job-seeker/profile – Обновить данные
Для работодателей:

GET /employer/profile – Данные компании
PUT /employer/profile – Обновить логотип/контакты
Для админов/модераторов:

GET /admin/users – Список пользователей
POST /admin/users/:id/ban – Заблокировать пользователя
4. Бизнес-логика

4.1. Регистрация

Валидация email и пароля (мин. 8 символов).
Проверка, что email не занят.
Хеширование пароля (bcrypt).
Создание записи в users и связанной таблице (job_seekers/employers).
4.2. Авторизация

Проверка учетных данных.
Генерация JWT-токена с полями:
json
{
  "id": 123,
  "role": "employer",
  "exp": 1735689600
}
4.3. Проверка прав (Middleware)

Пример на Go:

go
func AdminOnly(c *gin.Context) {
  claims := c.MustGet("claims").(jwt.MapClaims)
  if claims["role"] != "admin" {
    c.AbortWithStatusJSON(403, gin.H{"error": "Forbidden"})
    return
  }
  c.Next()
}
5. Интерфейсы

5.1. Соискатель

Профиль: Редактирование ФИО, аватарки, контактов.
Мое резюме: Просмотр/редактирование.
5.2. Работодатель

Профиль компании: Название, логотип, описание.
Мои вакансии: Список созданных объявлений.
5.3. Админ

Панель управления: Таблица пользователей с фильтрами.
Действия: Бан, смена ролей.
6. Защита данных

Пароли: Хеширование bcrypt.
Сессии: JWT с сроком действия 24 часа.
Роли: Проверка на каждом API-запросе.
7. Что проверить перед релизом

Регистрация с разными ролями работает.
Невозможно создать резюме с ролью employer.
Админ видит всех пользователей.
JWT-токен содержит актуальную роль.
Итог:
Этот модуль — фундамент для всей системы. Без него нельзя будет корректно реализовать:

Создание вакансий (только работодатели).
Модерацию контента.
Персональные настройки профилей.
Следующий шаг: После реализации — модуль объявлений с привязкой к employer_id.