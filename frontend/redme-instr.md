### **Техническое задание: Модуль объявлений (вакансий)**  
**Цель**: Реализовать функционал публикации, редактирования и поиска вакансий для работодателей с модерацией контента.  

---

## **1. Сущности и связи**  
### **1.1. Таблица `job_postings`**  
```sql
CREATE TABLE job_postings (
  id SERIAL PRIMARY KEY,
  employer_id INTEGER NOT NULL REFERENCES users(id),
  title VARCHAR(100) NOT NULL,              -- "Повар холодного цеха"
  description TEXT NOT NULL,                 -- Подробное описание
  salary_range VARCHAR(50),                  -- "от 80 000 ₽" или "по договорённости"
  location VARCHAR(100),                     -- Город/адрес
  employment_type VARCHAR(50),               -- "полная занятость", "сменный график"
  is_active BOOLEAN DEFAULT TRUE,            -- Активно ли объявление
  is_approved BOOLEAN DEFAULT FALSE,         -- Прошло ли модерацию
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP
);
```

### **1.2. Дополнительные таблицы**  
```sql
-- Категории вакансий (общепит, фастфуд и т.д.)
CREATE TABLE job_categories (
  id SERIAL PRIMARY KEY,
  name VARCHAR(50) UNIQUE NOT NULL           -- "Шеф-повар", "Бариста"
);

-- Связь вакансий с категориями (многие-ко-многим)
CREATE TABLE job_posting_categories (
  job_id INTEGER REFERENCES job_postings(id),
  category_id INTEGER REFERENCES job_categories(id),
  PRIMARY KEY (job_id, category_id)
);
```

---

## **2. API Endpoints**  
### **2.1. Для работодателей**  
| Метод | Путь                    | Описание                              |  
|-------|-------------------------|---------------------------------------|  
| POST  | `/job-postings`         | Создать вакансию                      |  
| GET   | `/job-postings/my`      | Список моих вакансий                  |  
| PUT   | `/job-postings/:id`     | Обновить вакансию                     |  
| DELETE| `/job-postings/:id`     | Удалить вакансию (или деактивировать) |  

### **2.2. Для соискателей**  
| Метод | Путь                    | Описание                              |  
|-------|-------------------------|---------------------------------------|  
| GET   | `/job-postings`         | Поиск вакансий (фильтры)              |  
| GET   | `/job-postings/:id`     | Детали вакансии                       |  

### **2.3. Для модераторов/админов**  
| Метод | Путь                    | Описание                              |  
|-------|-------------------------|---------------------------------------|  
| GET   | `/admin/job-postings`   | Список на модерацию                   |  
| PUT   | `/admin/job-postings/:id/approve` | Одобрить вакансию             |  
| DELETE| `/admin/job-postings/:id/reject`  | Отклонить с причиной       |  

---

## **3. Бизнес-логика**  
### **3.1. Создание вакансии**  
1. Проверка роли пользователя (`employer`).  
2. Валидация полей:  
   - `title`: мин. 5 символов, макс. 100.  
   - `description`: мин. 50 символов.  
3. Привязка к категориям (если указаны).  

**Пример запроса**:  
```json
{
  "title": "Повар холодного цеха",
  "description": "Требуется повар для работы с закусками...",
  "salary_range": "от 70 000 ₽",
  "location": "Москва",
  "employment_type": "полная занятость",
  "categories": [1, 3]  -- ID категорий
}
```

### **3.2. Модерация**  
- Новые вакансии попадают в очередь на проверку (`is_approved = FALSE`).  
- Модератор проверяет:  
  - Отсутствие запрещенного контента.  
  - Корректность контактов.  
- При отклонении указывается причина (сохраняется в отдельной таблице `moderation_rejects`).  

### **3.3. Поиск вакансий**  
**Параметры запроса**:  
- `?category=1` – Фильтр по категории.  
- `?location=Москва` – По городу.  
- `?salary_min=70000` – Минимальная зарплата.  

**Пример ответа**:  
```json
{
  "id": 123,
  "title": "Повар холодного цеха",
  "salary_range": "от 70 000 ₽",
  "location": "Москва",
  "company_name": "Ресторан 'Алматы'",
  "is_approved": true
}
```

---

## **4. Интерфейсы**  
### **4.1. Для работодателя**  
- **Форма создания вакансии**:  
  - Поля: заголовок, описание, зарплата, график.  
  - Выбор категорий (чекбоксы).  
- **Список моих вакансий**:  
  - Статус модерации (`approved/pending/rejected`).  
  - Кнопки "Редактировать", "Скрыть".  

### **4.2. Для соискателя**  
- **Карточка вакансии**:  
  - Контакты работодателя (видно только после одобрения).  
  - Кнопка "Откликнуться".  
- **Фильтры**: по зарплате, локации, категории.  

### **4.3. Для модератора**  
- **Панель модерации**:  
  - Превью вакансии + кнопки "Одобрить"/"Отклонить".  
  - Поле для указания причины отказа.  

---

## **5. Интеграция с другими модулями**  
- **Проверка ролей**: Только `employer` может создавать вакансии.  
- **Отклики**: Связь с модулем резюме (соискатель прикрепляет резюме к отклику).  
- **Уведомления**:  
  - Работодатель получает уведомление при одобрении/отклонении.  
  - Соискатель — при появлении новых вакансий в категориях.  

---

## **6. Технические требования**  
1. **Авторизация**: JWT с проверкой роли.  
2. **Валидация**:  
   - Запрет HTML-тегов в описании.  
   - Автоматическая проверка на дубликаты (по заголовку + работодателю).  
3. **Безопасность**:  
   - Контакты работодателя скрыты до одобрения модератором.  
   - Нет доступа к чужим вакансиям через `PUT/DELETE`.  

---

## **7. Что проверить перед релизом**  
1. Работодатель не может одобрить свою вакансию.  
2. Соискатель видит только активные (`is_active = TRUE`) и одобренные (`is_approved = TRUE`) вакансии.  
3. При отклонении вакансии работодатель получает email с причиной.  

---

**Итог**:  
Этот модуль свяжет соискателей и работодателей, обеспечит контроль контента и гибкий поиск.  

**Следующие шаги**:  
1. Модуль откликов на вакансии.  
2. Система уведомлений.  
3. Чат между работодателем и соискателем.